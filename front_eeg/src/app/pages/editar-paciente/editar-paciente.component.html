<div class="container">
<app-menu-lateral></app-menu-lateral>
<div class="patient-edit-container">
  <div class="header">
    <div class="left">
      <button (click)="regresar()" class="regresar">
        <i class="fas fa-arrow-left" aria-hidden="true"></i>
      </button>
      <h1>Ver {{patient.nombre}} {{patient.apellido_paterno}}</h1>
    </div>
    <div class="form-actions">
      <button class="button-eliminar" (click)="onDeletePatient()" [ngClass]="{'confirm': isConfirmDelete, 'done': isDeleted}">
        <i class="icon fas fa-trash" *ngIf="!isConfirmDelete && !isDeleted"></i>
        <i class="icon fas fa-question-circle" *ngIf="isConfirmDelete && !isDeleted"></i>
        <i class="icon fas fa-check-circle" *ngIf="isDeleted"></i>
        <span class="text">{{ isDeleted ? 'Eliminado' : (isConfirmDelete ? '¿Seguro?' : 'Eliminar') }}</span>
    </button>
  </div>
    </div>
    <div class="tab-menu">
      <button class="tab" id="tab" (click)="setActiveTab('infoPatient')" [class.active]="activeTab === 'infoPatient'">Información del paciente</button>
      <button class="tab" id="tab" (click)="setActiveTab('contactPatient')" [class.active]="activeTab === 'contactPatient'">Contacto del paciente</button>
      <!-- <button class="tab" id="tab" (click)="setActiveTab('historyPatient')" [class.active]="activeTab === 'historyPatient'">Informacion clinica</button> -->
      <button class="tab" id="tab" (click)="setActiveTab('infoFamily')" [class.active]="activeTab === 'infoFamily'">Información del familiar</button>
      <button class="tab" id="tab" (click)="setActiveTab('consent')" [class.active]="activeTab === 'consent'">Consentimiento</button>
    </div>
    <div class="tab-content">
      <!-- Información del paciente -->
      <div *ngIf="activeTab === 'infoPatient'">
        <form (ngSubmit)="onSubmit()" ngForm>
          <h2>Contacto de emergencia</h2>

          <!-- Dentro de <div *ngIf="activeTab === 'infoPatient'"> y otros tabs según corresponda -->
          <div class="form-actions">
            <!-- Cambiar aquí para llamar a onSubmit cuando se guarde -->
            <button type="button" class="edit" (click)="isEditMode ? onSubmit() : toggleEditMode()">{{ isEditMode ? 'Guardar Cambios' : 'Editar' }}</button>
          </div>
          <div class="form-section">              
            <label for="firstName">Nombre:</label>
            <input type="text" id="firstName" name="firstName" [(ngModel)]="patient.nombre" required [readonly]="!isEditMode">
            
            <label for="lastName">Apellido paterno:</label>
            <input type="text" id="lastName" name="lastName" [(ngModel)]="patient.apellido_paterno" required [readonly]="!isEditMode">
            
            <label for="surname">Apellido materno:</label>
            <input type="text" id="surname" name="surname"[(ngModel)]="patient.apellido_materno" required [readonly]="!isEditMode">
            
            <label for="birthDate">Fecha de nacimiento:</label>
            <input type="date" id="birthDate" name="birthDate" [(ngModel)]="patient.fecha_nacimiento" required [readonly]="!isEditMode" [value]="patient.fecha_nacimiento | date:'yyyy-MM-dd'">
            
            <!-- Género guardado -->
            <div *ngIf="!isEditMode">
              <label>Género:</label>
              <span>{{ getGeneroDisplay(patient.genero)}}</span>
            </div>

            <!-- Botones de radio para editar -->
            <div *ngIf="isEditMode">
              <label for="gender">Género:</label>
              <div id="gender">
                <label>
                  <input type="radio" name="gender" value="Masculino" [(ngModel)]="patient.genero"> Masculino
                </label>
                <label>
                  <input type="radio" name="gender" value="Femenino" [(ngModel)]="patient.genero"> Femenino
                </label>
              </div>
            </div>
            <br>

            <!-- Estado civil guardado -->
            <div *ngIf="!isEditMode">
              <label>Estado civil:</label>
              <span>{{ getEstadoCivil(patient.estado_civil) }}</span>
            </div>

            <!-- Botones de radio para editar -->
            <div *ngIf="isEditMode">
              <label>Estado civil:</label>
              <label>
                <input type="radio" name="civilStatus" value="Soltero/a" [(ngModel)]="patient.estado_civil"> Soltero/a
              </label>
              <label>
                <input type="radio" name="civilStatus" value="Casado/a" [(ngModel)]="patient.estado_civil"> Casado/a
              </label>
              <label>
                <input type="radio" name="civilStatus" value="3" [(ngModel)]="patient.estado_civil"> Divorciado/a
              </label>
              <label>
                <input type="radio" name="civilStatus" value="4" [(ngModel)]="patient.estado_civil"> Viudo/a
              </label>
            </div>
            <br>
  
            <!-- Lateralidad guardada -->
            <div *ngIf="!isEditMode">
              <label>Lateralidad:</label>
              <span>{{ getLateralidadDisplay(patient.lateralidad) }}</span>
            </div>

            <!-- Selector para editar Lateralidad -->
            <div *ngIf="isEditMode">
              <label for="laterality">Lateralidad:</label>
              <label>
                <input type="radio" name="laterality" value="Zurdo" [(ngModel)]="patient.lateralidad"> Zurdo
              </label>
              <label>
                <input type="radio" name="laterality" value="Diestro" [(ngModel)]="patient.lateralidad"> Diestro
              </label>
              <label>
                <input type="radio" name="laterality" value="Ambidiestro" [(ngModel)]="patient.lateralidad"> Ambidiestro
              </label>
            </div>
            <br>

            <!-- Escolaridad guardada -->
            <div *ngIf="!isEditMode">
              <label>Escolaridad:</label>
              <span>{{ getEscolaridadDisplay(patient.escolaridad) }}</span>
            </div>

            <!-- Selector para editar Escolaridad -->
            <div *ngIf="isEditMode">
              <label for="educationLevel">Escolaridad:</label>
              <label>
                <input type="radio" name="educationLevel" value="Primaria" [(ngModel)]="patient.escolaridad"> Primaria
              </label>
              <label>
                <input type="radio" name="educationLevel" value="Secundaria" [(ngModel)]="patient.escolaridad"> Secundaria
              </label>
              <label>
                <input type="radio" name="educationLevel" value="Preparatoria" [(ngModel)]="patient.escolaridad"> Preparatoria
              </label>
              <label>
                <input type="radio" name="educationLevel" value="Universidad" [(ngModel)]="patient.escolaridad"> Universidad
              </label>
              <label>
                <input type="radio" name="educationLevel" value="Maestría" [(ngModel)]="patient.escolaridad"> Maestría
              </label>
              <label>
                <input type="radio" name="educationLevel" value="Doctorado" [(ngModel)]="patient.escolaridad"> Doctorado
              </label>
            </div>
            <br>

            <div *ngIf="!isEditMode">
              <label>Ocupación:</label>
              <span>{{ getOcupationDisplay(patient.ocupacion) }}</span>
            </div>

            <div *ngIf="isEditMode">
              <label for="occupation">Ocupación:</label>
              <label>
                <input type="radio" name="occupation" value="Estudiante" [(ngModel)]="patient.ocupacion"> Estudiante
              </label>
              <label>
                <input type="radio" name="occupation" value="Empleado" [(ngModel)]="patient.ocupacion"> Empleado
              </label>
              <label>
                <input type="radio" name="occupation" value="Empresario" [(ngModel)]="patient.ocupacion"> Empresario
              </label>
              <label>
                <input type="radio" name="occupation" value="Independiente" [(ngModel)]="patient.ocupacion"> Independiente
              </label>
            </div>
            <br>
      </div>
    </form>
  </div>

      <!-- Contacto del paciente-->:
      <div *ngIf="activeTab === 'contactPatient'">
        <form (ngSubmit)="onSubmit()" ngForm>
          <h2>Contacto del paciente</h2>
          <div class="form-actions">
            <button type="button" class="edit" (click)="toggleEditMode()">{{ isEditMode ? 'Guardar Cambios' : 'Editar' }}</button>
          </div>
          <div class="form-section">
            <label>Teléfonos celulares:</label>
            <div *ngFor="let phone of patient.telefonos; let i = index">
              <input type="text" [id]="'phone' + i" [name]="'phone' + i" [(ngModel)]="patient.telefonos[i].telefono" [readonly]="!isEditMode">
          </div>

            <label>Correos electrónicos:</label>
            <div *ngFor="let email of patient.correos_electronicos; let i = index">
              <input type="text" [id]="'email' + i" [name]="'email' + i" [(ngModel)]="patient.correos_electronicos[i].correo_electronico" [readonly]="!isEditMode">
            </div>

            <label>Direcciones:</label>
            <div *ngFor="let address of patient.direcciones; let i = index">
              <input type="text" [id]="'address' + i" [name]="'address' + i" [(ngModel)]="patient.direcciones[i].calle_numero" placeholder="Calle y número" [readonly]="!isEditMode">
              <input type="text" [id]="'city' + i" [name]="'city' + i" [(ngModel)]="patient.direcciones[i].ciudad" placeholder="Ciudad" [readonly]="!isEditMode">
              <input type="text" [id]="'state' + i" [name]="'state' + i" [(ngModel)]="patient.direcciones[i].estado" placeholder="Estado" [readonly]="!isEditMode">
              <input type="text" [id]="'zipCode' + i" [name]="'zipCode' + i" [(ngModel)]="patient.direcciones[i].codigo_postal" placeholder="Código postal" [readonly]="!isEditMode">
              <input type="text" [id]="'country' + i" [name]="'country' + i" [(ngModel)]="patient.direcciones[i].pais" placeholder="País" [readonly]="!isEditMode">
            </div>
          </div>
        </form>
      </div>

      <!-- Historial del paciente
      <div *ngIf="activeTab === 'historyPatient'">
        <form (ngSubmit)="onSubmit()" ngForm>
          <h2>Informacion clinica</h2>
          <div class="form-actions">
            <button type="button" id="edit" (click)="toggleEditMode()">{{ isEditMode ? 'Guardar Cambios' : 'Editar' }}</button>
          </div>
          <div class="form-section">
            <label for="medicalHistory">Historial médico:</label>
            <textarea id="medicalHistory" name="medicalHistory" [(ngModel)]="patient.historial_medico" required [readonly]="!isEditMode"></textarea>
            
            <label for="currentMedication">Medicamentos actuales:</label>
            <table class="medications-table">
              <thead>
                <tr>
                  <th>Medicamento</th>
                  Agregar barra de busqueda que consuma obtener_medicamentos()
                  Sino encuentra el medicamento puede crear uno
                  <th *ngIf="isEditMode">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let medication of patient.medicamentos_actuales; let i = index">
                  <td>
                    <input type="text" name="medication-{{i}}" [(ngModel)]="patient.currentMedications[i]" [readonly]="!isEditMode">
                    <input type="text" name="medication-{{i}}" [readonly]="!isEditMode">
                  </td>
                  <td *ngIf="isEditMode">
                    <button type="button" id="delete" (click)="removeMedication(i)">Eliminar</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button type="button" id="add" (click)="addMedication()" *ngIf="isEditMode">Agregar medicamentos</button>
          </div>
        </form>
      </div> -->

      <!-- Información del familiar -->
      <div *ngIf="activeTab === 'infoFamily' && patient && patient.contacto_emergencia">
        <form (ngSubmit)="onSubmit()" ngForm>
          <h2>Información del familiar</h2>
          <div class="form-actions">
            <button type="button" class="edit" (click)="toggleEditMode()">{{ isEditMode ? 'Guardar Cambios' : 'Editar' }}</button>
          </div>
          <div class="form-section">
            <label for="relativeFirstName">Nombre(s):</label>
            <input type="text" id="relativeFirstName" name="relativeFirstName" [(ngModel)]="patient.contacto_emergencia.nombre" [readOnly]="!isEditMode">
      
            <label for="relativeLastName">Apellido paterno:</label>
            <input type="text" id="relativeLastName" name="relativeLastName" [(ngModel)]="patient.contacto_emergencia.apellido_paterno" [readOnly]="!isEditMode">
      
            <label for="relativeSurname">Apellido materno:</label>
            <input type="text" id="relativeSurname" name="relativeSurname" [(ngModel)]="patient.contacto_emergencia.apellido_materno" [readOnly]="!isEditMode">
      
            <label for="relationship">Parentesco:</label>
            <input type="text" id="relationship" name="relationship" [(ngModel)]="patient.contacto_emergencia.parentesco" [readOnly]="!isEditMode">
      
            <label for="relativePhone">Telefono:</label>
            <input type="text" id="relativePhone" name="relativePhone" [(ngModel)]="patient.contacto_emergencia.telefono" [readOnly]="!isEditMode">
      
            <label for="relativeEmail">Correo electronico:</label>
            <input type="text" id="relativeEmail" name="relativeEmail" [(ngModel)]="patient.contacto_emergencia.correo_electronico" [readOnly]="!isEditMode">
      
            <label for="relativeAddress">Dirección:</label>
            <input type="text" id="relativeAddress" name="relativeAddress" [(ngModel)]="patient.contacto_emergencia.direccion" [readOnly]="!isEditMode">
      
            <label for="relativeCity">Ciudad:</label>
            <input type="text" id="relativeCity" name="relativeCity" [(ngModel)]="patient.contacto_emergencia.ciudad" [readOnly]="!isEditMode">
      
            <label for="relativeState">Estado:</label>
            <input type="text" id="relativeState" name="relativeState" [(ngModel)]="patient.contacto_emergencia.estado" [readOnly]="!isEditMode">
      
            <label for="relativeZipCode">Código postal:</label>
            <input type="text" id="relativeZipCode" name="relativeZipCode" [(ngModel)]="patient.contacto_emergencia.codigo_postal" [readOnly]="!isEditMode">
      
            <label for="relativeCountry">País:</label>
            <input type="text" id="relativeCountry" name="relativeCountry" [(ngModel)]="patient.contacto_emergencia.pais" [readOnly]="!isEditMode">
      
            <label for="relativeNotes">Notas:</label>
            <textarea id="relativeNotes" name="relativeNotes" [(ngModel)]="patient.contacto_emergencia.notas" [readOnly]="!isEditMode"></textarea>
          </div>
        </form>
      </div>

      <!-- Consentimiento del paciente -->
      <div *ngIf="activeTab === 'consent'">
        <form (ngSubmit)="onSubmit()" ngForm>
          <h2>Consentimiento del paciente</h2>
          <div class="form-actions">
            <button type="button" class="edit" (click)="toggleEditMode()">{{ isEditMode ? 'Guardar Cambios' : 'Editar' }}</button>
          </div>
          <div *ngIf="!isEditMode">
            <label>Consentimiento:</label>
            <span>{{ getConsentimientoDisplay(this.patient.consentimientos) }}</span>
          </div>

          <div *ngIf="isEditMode">
            <label for="consent">Consentimiento del paciente:</label>
            <label>
              <input type="radio" name="occupation" value="1" [(ngModel)]="consentimientoTemporal.consentimiento"> El paciente ha dado su consentimiento
            </label>
            <label>
              <input type="radio" name="occupation" value="0" [(ngModel)]="consentimientoTemporal.consentimiento"> El paciente no ha dado su consentimiento
            </label>
          </div>
        </form>


      </div>
    </div>
  </div>
</div>